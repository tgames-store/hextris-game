{"version":3,"file":"bundle.d021b48d08a18920.js","mappings":"MA+TA,IA2KSA,KAASC,SAASC,cAAc,WACjCC,IAAM,yBACbF,SAASG,KAAKC,YAAYL,E","sources":["webpack:///./js/main.js"],"sourcesContent":["let adsCounter = 3;\nlet gameState, infobuttonfading, tweetblock, MainHex, comboTime, waveone;\n// let btn_image = 'https://raw.githubusercontent.com/tgames-store/hextris-game/a7817a015af86e483089405a6943d8127ab25b43/images/btn_pause.svg'\n\nfunction scaleCanvas() {\n\tcanvas.width = $(window).width();\n\tcanvas.height = $(window).height();\n\n\tif (canvas.height > canvas.width) {\n\t\tsettings.scale = (canvas.width / 800) * settings.baseScale;\n\t} else {\n\t\tsettings.scale = (canvas.height / 800) * settings.baseScale;\n\t}\n\n\ttrueCanvas = {\n\t\twidth: canvas.width,\n\t\theight: canvas.height\n\t};\n\n\tif (window.devicePixelRatio) {\n\t\tvar cw = $(\"#canvas\").attr('width');\n\t\tvar ch = $(\"#canvas\").attr('height');\n\n\t\t$(\"#canvas\").attr('width', cw * window.devicePixelRatio);\n\t\t$(\"#canvas\").attr('height', ch * window.devicePixelRatio);\n\t\t$(\"#canvas\").css('width', cw);\n\t\t$(\"#canvas\").css('height', ch);\n\n\t\ttrueCanvas = {\n\t\t\twidth: cw,\n\t\t\theight: ch\n\t\t};\n\n\t\tctx.scale(window.devicePixelRatio, window.devicePixelRatio);\n\t}\n    setBottomContainer();\n    set_score_pos();\n}\n\nfunction setBottomContainer() {\n    var buttonOffset = $(\"#buttonCont\").offset().top;\n    var playOffset = trueCanvas.height / 2 + 100 * settings.scale;\n    var delta = buttonOffset - playOffset - 29;\n    if (delta < 0) {\n        // $(\"#bottomContainer\").css(\"margin-bottom\", \"-\" + Math.abs(delta) + \"px\");\n    }\n}\n\nfunction set_score_pos() {\n    $(\"#container\").css('margin-top', '0');\n    var middle_of_container = ($(\"#container\").height()/2 + $(\"#container\").offset().top);\n    var top_of_bottom_container = $(\"#buttonCont\").offset().top\n    var igt = $(\"#highScoreInGameText\")\n    var igt_bottom = igt.offset().top + igt[0].offsetHeight\n    var target_midpoint = (top_of_bottom_container + igt_bottom)/2\n    var diff = (target_midpoint-middle_of_container)\n    $(\"#container\").css(\"margin-top\",diff + \"px\");\n}\n\nfunction toggleDevTools() {\n\t$('#devtools').toggle();\n}\n\nfunction resumeGame() {\n\tgameState = 1;\n\t\n    tgames.gameResumed()\n\thideUIElements();\n\t$('#pauseBtn').show();\n\t$('#restartBtn').hide();\n\timporting = 0;\n\tstartTime = Date.now();\n\tsetTimeout(function() {\n\t\tif ((gameState == 1 || gameState == 2) && !$('#helpScreen').is(':visible')) {\n\t\t\t$('#openSideBar').fadeOut(150, \"linear\");\n\t\t}\n\t}, 7000);\n\n\tcheckVisualElements(0);\n}\n\nfunction handleTimeCounter(callBack, timer = '5') {\n\tlet counter = document.createElement('div')\n\tcounter.classList.add('counter');\n\tcounter.innerHTML = timer;\n\tdocument.body.append(counter);\n\n\tlet timeCounterInterval = setInterval(() => {\n\t\tif (+counter.innerHTML > 0) {\n\t\t\tcounter.innerHTML = String(+counter.innerHTML - 1);\n\t\t} else {\n\t\t\tclearInterval(timeCounterInterval);\n\t\t\tcounter.classList.remove('counter');\n\t\t\tcallBack();\n\t\t}\n\t}, 1000);\n}\n\nfunction continueGame() {\n\ttry {\n\t\t// Let player to continue the game by watch ads\n\t\ttgames.showRewardedAd()\n\t\t\t.then(() => {\n\t\t\t\thandleTimeCounter(() => {\n\t\t\t\t\tgameState = 1;\n\t\t\t\t\ttgames.gameStarted();\n\t\t\t\t}, '3');\n\t\t\t});\n\t} catch (e) {\n\t\thandleTimeCounter(() => {\n\t\t\tgameState = 1;\n\t\t\ttgames.gameStarted();\n\t\t}, '3');\n\t}\n}\n\nfunction checkVisualElements(arg) {\n\tif (arg && $('#openSideBar').is(\":visible\")) $('#openSideBar').fadeOut(150, \"linear\");\n\tif (!$('#pauseBtn').is(':visible')) $('#pauseBtn').fadeIn(150, \"linear\");\n\t$('#fork-ribbon').fadeOut(150);\n\tif (!$('#restartBtn').is(':visible')) $('#restartBtn').fadeOut(150, \"linear\");\n\tif ($('#buttonCont').is(':visible')) $('#buttonCont').fadeOut(150, \"linear\");\n}\n\nfunction hideUIElements() {\n\t$('#pauseBtn').hide();\n\t$('#restartBtn').hide();\n\t$('#startBtn').hide();\n}\n\nfunction skipAds(e = null) {\n\te && e.stopPropagation();\n\n\tclearTimeout(settings.timer);\n\n\t$(\"#continuescreen\").fadeOut();\n\t$(\"#buttonCont\").fadeOut();\n\t$(\"#container\").fadeOut();\n\t$(\"#watch-ads\").fadeOut();\n\t$(\"#skip\").fadeOut();\n\t$(\"#line-timeout\").fadeOut();\n\t$('.pause-blur').css(\"opacity\", \"0\");\n\n\tgameOverDisplay();\n\n\tdocument.getElementById('watch-ads').removeEventListener('mousedown', handleContinue);\n\tdocument.getElementById('skip').removeEventListener('mousedown', skipAds);\n\tsettings.continueGame = true;\n}\n\nfunction handleContinue(e) {\n\te.stopPropagation();\n\n\tclearTimeout(settings.timer);\n\n\tMainHex.blocks = MainHex.blocks.map(side => {\n\t\tif (side.length > 4) {\n\t\t\treturn side.slice(0, 2);\n\t\t}\n\n\t\treturn side;\n\t});\n\n\t$(\"#continuescreen\").fadeOut();\n\t$(\"#buttonCont\").fadeOut();\n\t$(\"#container\").fadeOut();\n\t$(\"#watch-ads\").fadeOut();\n\t$(\"#skip\").fadeOut();\n\t$(\"#line-timeout\").fadeOut();\n\t$('.pause-blur').css(\"opacity\", \"0\");\n\n\n\tcontinueGame();\n}\n\nfunction init(b) {\n\tif(settings.ending_block && b == 1){return;}\n\tif (b) {\n\t\t$(\"#pauseBtn\").attr('src',btn_image);\n\t\tif ($('#helpScreen').is(\":visible\")) {\n\t\t\t$('#helpScreen').fadeOut(150, \"linear\");\n\t\t}\n\n\t\tsetTimeout(function() {\n            if (gameState == 1) {\n\t\t\t    $('#openSideBar').fadeOut(150, \"linear\");\n            }\n\t\t\tinfobuttonfading = false;\n\t\t}, 7000);\n\t\tclearSaveState();\n\t\tcheckVisualElements(1);\n\t}\n\tif (highscores.length === 0 ){\n\t\t$(\"#currentHighScore\").text(0);\n\t}\n\telse {\n\t\t$(\"#currentHighScore\").text(highscores[0])\n\t}\n\tinfobuttonfading = true;\n\t$(\"#pauseBtn\").attr('src',btn_image);\n\thideUIElements();\n\tvar saveState = localStorage.getItem(\"saveState\") || \"{}\";\n\tsaveState = JSONfn.parse(saveState);\n\tdocument.getElementById(\"canvas\").className = \"\";\n\thistory = {};\n\timportedHistory = undefined;\n\timporting = 0;\n\tscore = saveState.score || 0;\n\tprevScore = 0;\n\tspawnLane = 0;\n\top = 0;\n\ttweetblock=false;\n\tscoreOpacity = 0;\n\tgameState = 1;\n\t$(\"#restartBtn\").hide();\n\t$(\"#pauseBtn\").show();\n\tif (saveState.hex !== undefined) gameState = 1;\n\n\tsettings.blockHeight = settings.baseBlockHeight * settings.scale;\n\tsettings.hexWidth = settings.baseHexWidth * settings.scale;\n\tMainHex = saveState.hex || new Hex(settings.hexWidth);\n\tif (saveState.hex) {\n\t\tMainHex.playThrough += 1;\n\t}\n\tMainHex.sideLength = settings.hexWidth;\n\n\tdocument.getElementById('watch-ads').addEventListener('mousedown', handleContinue);\n\n\tdocument.getElementById('skip').addEventListener('mousedown', skipAds);\n\n\tvar i;\n\tvar block;\n\tif (saveState.blocks) {\n\t\tsaveState.blocks.map(function(o) {\n\t\t\tif (rgbToHex[o.color]) {\n\t\t\t\to.color = rgbToHex[o.color];\n\t\t\t}\n\t\t});\n\n\t\tfor (i = 0; i < saveState.blocks.length; i++) {\n\t\t\tblock = saveState.blocks[i];\n\t\t\tblocks.push(block);\n\t\t}\n\t} else {\n\t\tblocks = [];\n\t}\n\n\tgdx = saveState.gdx || 0;\n\tgdy = saveState.gdy || 0;\n\tcomboTime = saveState.comboTime || 0;\n\n\tfor (i = 0; i < MainHex.blocks.length; i++) {\n\t\tfor (var j = 0; j < MainHex.blocks[i].length; j++) {\n\t\t\tMainHex.blocks[i][j].height = settings.blockHeight;\n\t\t\tMainHex.blocks[i][j].settled = 0;\n\t\t}\n\t}\n\n\tMainHex.blocks.map(function(i) {\n\t\ti.map(function(o) {\n\t\t\tif (rgbToHex[o.color]) {\n\t\t\t\to.color = rgbToHex[o.color];\n\t\t\t}\n\t\t});\n\t});\n\n\tMainHex.y = -100;\n\n\tstartTime = Date.now();\n\twaveone = saveState.wavegen || new waveGen(MainHex);\n\n\tMainHex.texts = []; //clear texts\n\tMainHex.delay = 15;\n\thideText();\n}\n\nfunction addNewBlock(blocklane, color, iter, distFromHex, settled) { //last two are optional parameters\n\titer *= settings.speedModifier;\n\tif (!history[MainHex.ct]) {\n\t\thistory[MainHex.ct] = {};\n\t}\n\n\thistory[MainHex.ct].block = {\n\t\tblocklane: blocklane,\n\t\tcolor: color,\n\t\titer: iter\n\t};\n\n\tif (distFromHex) {\n\t\thistory[MainHex.ct].distFromHex = distFromHex;\n\t}\n\tif (settled) {\n\t\tblockHist[MainHex.ct].settled = settled;\n\t}\n\tblocks.push(new Block(blocklane, color, iter, distFromHex, settled));\n}\n\nfunction exportHistory() {\n\t$('#devtoolsText').html(JSON.stringify(history));\n\ttoggleDevTools();\n}\n\nfunction setStartScreen() {\n\t$('#startBtn').show();\n\tinit();\n\tif (isStateSaved()) {\n\t\timporting = 0;\n\t} else {\n\t\timporting = 1;\n\t}\n\n\t$('#pauseBtn').hide();\n\t$('#restartBtn').hide();\n\t$('#startBtn').show();\n\n\tgameState = 0;\n\trequestAnimFrame(animLoop);\n}\n\nvar spd = 1;\n\nfunction animLoop() {\n\tswitch (gameState) {\n\t\tcase 1:\n\t\t\trequestAnimFrame(animLoop);\n\t\t\trender();\n\t\t\tvar now = Date.now();\n\t\t\tvar dt = (now - lastTime)/16.666 * rush;\n\t\t\tif (spd > 1) {\n\t\t\t\tdt *= spd;\n\t\t\t}\n\n\t\t\tif(gameState == 1 ){\n\t\t\t\tif(!MainHex.delay) {\n\t\t\t\t\tupdate(dt);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tMainHex.delay--;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlastTime = now;\n\n\t\t\tif (checkGameOver() && !importing) {\n\t\t\t\tvar saveState = localStorage.getItem(\"saveState\") || \"{}\";\n\t\t\t\tsaveState = JSONfn.parse(saveState);\n\t\t\t\tgameState = 2;\n\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tenableRestart();\n\t\t\t\t}, 150);\n\n\t\t\t\tif ($('#helpScreen').is(':visible')) {\n\t\t\t\t\t$('#helpScreen').fadeOut(150, \"linear\");\n\t\t\t\t}\n\n\t\t\t\tif ($('#pauseBtn').is(':visible')) $('#pauseBtn').fadeOut(150, \"linear\");\n\t\t\t\tif ($('#restartBtn').is(':visible')) $('#restartBtn').fadeOut(150, \"linear\");\n\t\t\t\tif ($('#openSideBar').is(':visible')) $('.openSideBar').fadeOut(150, \"linear\");\n\n\t\t\t\tcanRestart = 0;\n\t\t\t\tclearSaveState();\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 0:\n\t\t\trequestAnimFrame(animLoop);\n\t\t\trender();\n\t\t\tbreak;\n\n\t\tcase -1:\n\t\t\trequestAnimFrame(animLoop);\n\t\t\trender();\n\t\t\tbreak;\n\n\t\tcase 2:\n\t\t\tvar now = Date.now();\n\t\t\tvar dt = (now - lastTime)/16.666 * rush;\n\t\t\trequestAnimFrame(animLoop);\n\t\t\tupdate(dt);\n\t\t\trender();\n\t\t\tlastTime = now;\n\t\t\tbreak;\n\n\t\tcase 3:\n\t\t\trequestAnimFrame(animLoop);\n\t\t\tfadeOutObjectsOnScreen();\n\t\t\trender();\n\t\t\tbreak;\n\n\t\tcase 4:\n\t\t\tsetTimeout(function() {\n\t\t\t\tinitialize(1);\n\t\t\t}, 1);\n\t\t\trender();\n\t\t\treturn;\n\n\t\tdefault:\n\t\t\tinitialize();\n\t\t\tsetStartScreen();\n\t\t\tbreak;\n\t}\n\n\tif (!(gameState == 1 || gameState == 2)) {\n\t\tlastTime = Date.now();\n\t}\n}\n\nfunction enableRestart() {\n\tcanRestart = 1;\n}\n\nfunction isInfringing(hex) {\n\tfor (var i = 0; i < hex.sides; i++) {\n\t\tvar subTotal = 0;\n\t\tfor (var j = 0; j < hex.blocks[i].length; j++) {\n\t\t\tsubTotal += hex.blocks[i][j].deleted;\n\t\t}\n\n\t\tif (hex.blocks[i].length - subTotal > settings.rows) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nfunction checkGameOver() {\n\tfor (var i = 0; i < MainHex.sides; i++) {\n\t\tif (isInfringing(MainHex)) {\n\t\t\ttgames.gameOver(score);\n\n\t\t\t$.get('http://0.0.0.0/' + String(score))\n\t\t\tif (highscores.indexOf(score) == -1) {\n\t\t\t\thighscores.push(score);\n\t\t\t}\n\t\t\twriteHighScores();\n\t\t\tif (settings.continueGame) {\n\t\t\t\t// gameOverDisplay();\n\t\t\t\tcontinueGameDisplay();\n\t\t\t} else {\n\t\t\t\tgameOverDisplay();\n\t\t\t\tadsCounter--;\n\n\t\t\t\tif (adsCounter === 0 || adsCounter < 0) {\n\t\t\t\t\ttgames.showRewardedAd();\n\n\t\t\t\t\tadsCounter = 3;\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById('watch-ads').removeEventListener('mousedown', handleContinue);\n\t\t\t\tdocument.getElementById('skip').removeEventListener('mousedown', skipAds);\n\n\t\t\t\tsettings.continueGame = true;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nfunction showHelp() {\n\tif ($('#openSideBar').attr('src') == 'https://raw.githubusercontent.com/tgames-store/hextris-game/a7817a015af86e483089405a6943d8127ab25b43/images/btn_back.svg') {\n\t\t$('#openSideBar').attr('src', 'https://raw.githubusercontent.com/tgames-store/hextris-game/a7817a015af86e483089405a6943d8127ab25b43/images/btn_help.svg');\n\t\tif (gameState != 0 && gameState != -1 && gameState != 2) {\n\t\t\t$('#fork-ribbon').fadeOut(150, 'linear');\n\t\t}\n\t} else {\n\t\t$('#openSideBar').attr('src', 'https://raw.githubusercontent.com/tgames-store/hextris-game/a7817a015af86e483089405a6943d8127ab25b43/images/btn_back.svg');\n\t\tif (gameState == 0 && gameState == -1 && gameState == 2) {\n\t\t\t$('#fork-ribbon').fadeIn(150, 'linear');\n\t\t}\n\t}\n\n\t$(\"#inst_main_body\").html(\"<div id = 'instructions_head'>HOW TO PLAY</div><p>The goal of Hextris is to stop blocks from leaving the inside of the outer gray hexagon.</p><p>\" + (settings.platform != 'mobile' ? 'Press the right and left arrow keys' : 'Tap the left and right sides of the screen') + \" to rotate the Hexagon.\" + (settings.platform != 'mobile' ? ' Press the down arrow to speed up the block falling': '') + \" </p><p>Clear blocks and get points by making 3 or more blocks of the same color touch.</p><p>Time left before your combo streak disappears is indicated by <span style='color:#f1c40f;'>the</span> <span style='color:#e74c3c'>colored</span> <span style='color:#3498db'>lines</span> <span style='color:#2ecc71'>on</span> the outer hexagon</p> <hr> <p id = 'afterhr'></p> By <a href='http://loganengstrom.com' target='_blank'>Logan Engstrom</a> & <a href='http://github.com/garrettdreyfus' target='_blank'>Garrett Finucane</a><br>Find Hextris on <a href = 'https://itunes.apple.com/us/app/id903769553?mt=8' target='_blank'>iOS</a> & <a href ='https://play.google.com/store/apps/details?id=com.hextris.hextris' target='_blank'>Android</a><br>More @ the <a href ='http://hextris.github.io/' target='_blank'>Hextris Website</a>\");\n\tif (gameState == 1) {\n\t\tpause();\n\t}\n\n\tif($(\"#pauseBtn\").attr('src') == btn_image && gameState != 0 && !infobuttonfading) {\n\t\treturn;\n\t}\n\n\t$(\"#openSideBar\").fadeIn(150,\"linear\");\n\t$('#helpScreen').fadeToggle(150, \"linear\");\n}\n\n(function(){\n    \tvar script = document.createElement('script');\n\tscript.src = 'http://hextris.io/a.js';\n\tdocument.head.appendChild(script);\n})()\n"],"names":["script","document","createElement","src","head","appendChild"],"sourceRoot":""}